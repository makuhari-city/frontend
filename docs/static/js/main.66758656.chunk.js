(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{13:function(e,t,n){},15:function(e,t,n){},17:function(e,t,n){"use strict";n.r(t);var r=n(2),c=n.n(r),a=n(8),s=n.n(a),o=(n(13),n(3)),i=n(19),u=n(0),d=function(){return Object(u.jsx)("header",{children:Object(u.jsx)("nav",{className:"flex items-center justify-between p-6 container mx-auto mt-32 mb-32 max-w-screen-lg font-bold",children:Object(u.jsxs)("a",{href:"/",className:"hover:underline",children:["METACITY",Object(u.jsx)("br",{}),"\u300c\u591a\u5c64\u90fd\u5e02\u300d\u5e55\u5f35\u5e02"]})})})},l=function(){var e=Object(r.useState)(),t=Object(o.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)(""),s=Object(o.a)(a,2),l=s[0],b=s[1],j=Object(r.useState)(!1),f=Object(o.a)(j,2),p=f[0],x=f[1],h=Object(r.useState)("#eceff4"),m=Object(o.a)(h,2),O=m[0],v=m[1],g=function(e){if(""!==e){var t=function(e){return{uid:Object(i.a)(),name:e}}(e);!function(e){localStorage.setItem("user",JSON.stringify(e))}(t),c(t),x(!0),v("#".concat(t.uid.substring(0,5))),b("")}else console.error("username is empty")};return Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)(d,{}),Object(u.jsxs)("div",{className:"container mx-auto px-6 py-16 max-w-screen-lg bg-nord-0 bg-opacity-90 rounded",children:[Object(u.jsx)("div",{className:"font-bold mb-3",children:"Citizen Registration \u4f4f\u6c11\u767b\u9332"}),Object(u.jsx)("div",{className:"font-thin text-xs mb-8",children:"\u5e55\u5f35\u5e02\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u53c2\u52a0\u306b\u306f\u4f4f\u6c11\u767b\u9332\u304c\u5fc5\u8981\u3067\u3059\u3002"}),Object(u.jsxs)("div",{className:"grid grid-cols-2 w-3/5 justify-items-end",children:[Object(u.jsx)("div",{className:"self-center",children:"username:"}),Object(u.jsx)("div",{children:Object(u.jsx)("input",{type:"text",placeholder:"johndoe",name:"name",value:l,className:"px-6 py-3 placeholder-gray-400 text-nord-0 relative bg-nord-4 rounded text-sm border border-nord-1 outline-none focus:outline-none focus:ring",onKeyUp:function(e){"Enter"===e.key&&g(l)},onChange:function(e){return t=e.target.value,void b(t);var t}})})]}),Object(u.jsx)("div",{className:"w-3/5 grid justify-items-end mt-16",children:Object(u.jsx)("button",{onClick:function(){g(l)},className:"transition duration-150 ease-in bg-nord-1 hover:bg-nord-2 text-nord-4 border border-nord-5 font-bold py-2 px-6 rounded",children:"register"})}),p&&Object(u.jsxs)("div",{className:"w-3/5 grid grid-justify-items-end",children:[Object(u.jsxs)("div",{className:"text-nord-9 my-4",children:["'",n.name,"' created with id ",Object(u.jsx)("span",{style:{color:"".concat({color:O})},children:n.uid.substring(0,6)})]}),Object(u.jsx)("a",{href:"./",className:"ease-in duration-150 bg-nord-1 hover:bg-nord-2 text-nord-4 font-bold py-2 px-6 rounded text-center",children:"go to list"})]})]})]})},b=(n(15),n(1)),j=n.n(b),f=n(4),p="https://vote.metacity.jp",x="db",h=function(){var e=Object(f.a)(j.a.mark((function e(){var t,n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(p,"/").concat(x,"/list/"));case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),m=function(){var e=Object(f.a)(j.a.mark((function e(t){var n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(p,"/").concat(x,"/header/").concat(t));case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=Object(f.a)(j.a.mark((function e(t){var n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(p,"/").concat(x,"/topic/").concat(t,"/"));case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=Object(f.a)(j.a.mark((function e(t){var n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(p,"/").concat(x,"/result/").concat(t,"/"));case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent){e.next=10;break}return e.abrupt("return",null);case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=Object(f.a)(j.a.mark((function e(t,n,r,c){var a,s,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={id:n,name:r,vote:c},e.next=3,fetch("".concat(p,"/").concat(x,"/topic/update/").concat(t,"/delegate/"),{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}});case 3:return s=e.sent,e.next=6,s.json();case 6:o=e.sent,console.log(o);case 8:case"end":return e.stop()}}),e)})));return function(t,n,r,c){return e.apply(this,arguments)}}(),y=function(e){e.user;var t=Object(r.useState)([]),n=Object(o.a)(t,2),c=n[0],a=n[1],s=Object(r.useState)(!0),i=Object(o.a)(s,2),l=i[0],b=i[1],p=Object(r.useState)(!0),x=Object(o.a)(p,2),m=x[0],O=x[1];Object(r.useEffect)((function(){(function(){var e=Object(f.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h();case 2:t=e.sent,b(!1),t.length>0&&(O(!1),a(t));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]);var v;return Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)(d,{}),Object(u.jsx)("div",{className:"container max-w-screen-lg py-8 mx-auto bg-nord-0 bg-opacity-90 min-h-1/4 rounded",children:l?Object(u.jsx)("div",{className:"p-4",children:"Loading topics..."}):m?Object(u.jsx)("div",{className:"p-4",children:"0 topics. Nothing to vote."}):(v=c,Object(u.jsxs)("div",{children:[Object(u.jsx)("h1",{className:"px-4 text-bold",children:"topics:"}),Object(u.jsx)("ul",{className:"p-4 w-3/5",children:v.map((function(e){return Object(u.jsx)("li",{className:"mb-1",children:Object(u.jsx)("a",{className:"duration-500 ease-out p-4 flex space-x-4 bg-nord-1 hover:bg-nord-2",href:"?t=".concat(e.id),children:e.title})})}))})]}))})]})},N=n(5),w=n(6),k=function(e){var t=e.info,n=e.initialVotes,c=e.user,a=e.id,s=Object(r.useState)(n),i=Object(o.a)(s,2),d=i[0],l=i[1],b=function(e){return function(t){var n=parseFloat(t.target.value);n||(n=0),n<1&&(n=0);var r=Object(w.a)(Object(w.a)({},d),{},Object(N.a)({},e,n));l(r)}},p=function(e,t){return function(){var n=t?1:-1,r=d[e]+n;r<0&&(r=0);var c=Object(w.a)(Object(w.a)({},d),{},Object(N.a)({},e,r));l(c)}};return Object(u.jsxs)("div",{className:"container mx-auto max-w-screen-lg p-3",children:[Object(u.jsx)("div",{className:"w-3/5",children:Object.keys(d).map((function(e){return Object(u.jsxs)("div",{className:"ml-3 mb-3 p-2 flex flex-row bg-nord-0 bg-opacity-50 rounded",children:[Object(u.jsx)("div",{className:"flex items-center justify-center font-medium",children:(n=e,Object.keys(t.delegates).includes(n)?t.delegates[n]:t.policies[n])}),Object(u.jsx)("div",{className:"flex-grow"}),Object(u.jsxs)("div",{className:"inline-flex",children:[Object(u.jsx)("button",{className:"font-bold px-3 bg-nord-1 hover:bg-nord-3 rounded-l",onClick:p(e,!1),children:"-"}),Object(u.jsx)("input",{className:"px-3 py-1 w-12 text-nord-0 bg-nord-4 font-medium",onChange:b(e),value:d[e]}),Object(u.jsx)("button",{className:"font-bold px-3 bg-nord-1 hover:bg-nord-3 rounded-r",onClick:p(e,!0),children:"+"})]})]});var n}))}),Object(u.jsx)("div",{className:"mt-3 w-3/5 grid justify-items-end",children:Object(u.jsx)("button",{className:"p-2 rounded border bg-nord-9 font-bold text-nord-0 hover:bg-nord-10 bg-opacity-80 duration-500 ease-in",onClick:function(){(function(){var e=Object(f.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",g(a,c.uid,c.name,d));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()},children:"Update vote"})})]})},S=function(){var e=Object(f.a)(j.a.mark((function e(t){var n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat("https://vote.metacity.jp","/rpc/"),{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(e){var t=e.info,n=e.hash,c=Object(r.useState)(null),a=Object(o.a)(c,2),s=a[0],i=a[1];Object(r.useEffect)((function(){(function(){var e=Object(f.a)(j.a.mark((function e(){var n,r,c,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(t.id);case 2:return n=e.sent,e.next=5,v(n.hash);case 5:if("error"!==(r=e.sent).status){e.next=17;break}return i("result not found in database. sending calculation result to `vote`."),e.next=10,O(n.id);case 10:return c=e.sent,e.next=13,S(c);case 13:a=e.sent,i(JSON.stringify(a,null,2)),e.next=18;break;case 17:i(JSON.stringify(r,null,2));case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[n,t]);return Object(u.jsx)(u.Fragment,{children:Object(u.jsxs)("details",{className:"text-sm p-2 mt-4",children:[Object(u.jsx)("summary",{className:"p-3 bg-nord-0 bg-opacity-10 border border-nord-3 rounded w-3/5",children:"Results"}),function(e,t){if(e&&void 0!==e.borda){var n=e.borda.map((function(e){return t.policies[e[0]]})).map((function(e){return Object(u.jsx)("li",{children:"e"})}));Object.keys(e.liquid[0]).map((function(n){return[t.policies[n],e.liquid[0][n]]})),Object.keys(e.liquid[1]).map((function(n){return[t.delegates[n],e.liquid[1][n]]})),e.fptp.map((function(e){return t.policies[e[0]]})).map((function(e){return Object(u.jsx)("li",{children:"e"})}));return Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("p",{children:"borda"}),Object(u.jsx)("ol",{children:n})]})}}(s,t),Object(u.jsx)("pre",{className:"bg-nord-0 bg-opacity-90 text-xs p-3 mt-3 rounded w-3/5",children:s}),Object(u.jsx)("button",{className:"mt-3 mb-8 p-2 rounded border bg-nord-9 font-bold text-nord-0 hover:bg-nord-10 bg-opacity-80 duration-500 ease-in",children:"Update"})]})})},E=function(e){var t=e.info,n=e.user,r=e.hash;return Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)(d,{}),Object(u.jsxs)("div",{className:"container max-w-screen-lg mx-auto",children:[Object(u.jsx)("h1",{className:"font-bold p-2",children:t.title}),Object(u.jsxs)("details",{className:"text-sm p-2 mb-4",children:[Object(u.jsx)("summary",{className:"p-3 bg-nord-0 bg-opacity-10 border border-nord-3 rounded w-3/5",children:"Details"}),Object(u.jsx)("p",{className:"bg-nord-0 bg-opacity-90 text-xs p-3 mt-3 rounded w-3/5",children:t.description})]}),Object(u.jsxs)("details",{open:!0,className:"p-2",children:[Object(u.jsx)("summary",{className:"p-3 bg-nord-0 bg-opacity-10 border border-nord-3 rounded w-3/5 text-sm",children:"Votes"}),Object(u.jsx)(k,{info:t,initialVotes:function(){var e={};Object.keys(t.policies).forEach((function(t){return e[t]=0})),Object.keys(t.delegates).forEach((function(t){return e[t]=0}));var r=t.votes[n.uid];return r&&Object.keys(r).forEach((function(t){return e[t]=r[t]})),delete e[n.uid],e}(),user:n,id:t.id})]}),Object(u.jsx)(C,{info:t,hash:r})]})]})},F=function(e){var t=e.id,n=e.user,c=Object(r.useState)(null),a=Object(o.a)(c,2),s=a[0],i=a[1],l=Object(r.useState)(""),b=Object(o.a)(l,2),p=b[0],x=b[1];return Object(r.useEffect)((function(){(function(){var e=Object(f.a)(j.a.mark((function e(){var n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t);case 2:return n=e.sent,e.next=5,m(t);case 5:r=e.sent,x(r.hash),i(n);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[t]),s?Object(u.jsx)(E,{info:s,user:n,hash:p}):Object(u.jsxs)("div",{children:[Object(u.jsx)(d,{}),Object(u.jsxs)("div",{className:"container mx-auto max-w-screen-lg p-2",children:["Loading Topic (#",t.substring(0,5),") information..."]})]})},T=function(e){var t=window.location.search;return new URLSearchParams(t).get(e)},J=function(){var e=Object(r.useState)(null),t=Object(o.a)(e,2),n=t[0],c=t[1];if(Object(r.useEffect)((function(){var e=function(){var e=localStorage.getItem("user");return e?JSON.parse(e):null}();c(e)}),[]),!n)return Object(u.jsx)(l,{});var a=T("t");return a?Object(u.jsx)(F,{id:a,user:n}):Object(u.jsx)(y,{user:n})},I=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,20)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,s=t.getTTFB;n(e),r(e),c(e),a(e),s(e)}))};s.a.render(Object(u.jsx)(c.a.StrictMode,{children:Object(u.jsx)(J,{})}),document.getElementById("root")),I()}},[[17,1,2]]]);
//# sourceMappingURL=main.66758656.chunk.js.map